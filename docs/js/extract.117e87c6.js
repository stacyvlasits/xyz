(function(t){function e(e){for(var o,r,a=e[0],c=e[1],h=e[2],l=0,u=[];l<a.length;l++)r=a[l],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&u.push(i[r][0]),i[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);d&&d(e);while(u.length)u.shift()();return s.push.apply(s,h||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],o=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(o=!1)}o&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var o={},i={extract:0},s=[];function r(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=o,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/xyz/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var h=0;h<a.length;h++)e(a[h]);var d=c;s.push([2,"chunk-vendors","chunk-common"]),n()})({2:function(t,e,n){t.exports=n("5b37")},"5b37":function(t,e,n){"use strict";n.r(e);var o=n("f2bf"),i=n("05a8"),s=n("a911"),r=n("6bdf"),a=n("b1d2");const c=Object(o["o"])("data-v-01fbb576");Object(o["h"])("data-v-01fbb576");const h={class:"coords-bounds-form"},d=Object(o["e"])("a",{id:"dlbtn",class:"button",download:"extract.xyz"},"Download",-1),l=Object(o["e"])("h3",null,"Center Point Coordinate",-1);Object(o["g"])();const u=c((t,e,n,i,s,r)=>{const a=Object(o["j"])("coords-form"),c=Object(o["j"])("bounds-form");return Object(o["f"])(),Object(o["c"])("div",h,[d,l,Object(o["e"])(a,{coordinate:n.coordinate,onCoordChanged:r.onLVCoord},null,8,["coordinate","onCoordChanged"]),Object(o["e"])(c,{min:n.min,max:n.max,onBoundsChanged:r.onBounds},null,8,["min","max","onBoundsChanged"])])});var m=n("5110"),w=n("3fd7"),p=n("ea67"),x={props:{coordinate:Object,min:Object,max:Object},components:{CoordsForm:m["a"],BoundsForm:w["a"]},methods:{setLatLon(t,e){this.coordinate.lat=t,this.coordinate.lon=e,[this.coordinate.N,this.coordinate.E]=Object(p["d"])(t,e)},setLv95(t,e){this.coordinate.N=t,this.coordinate.E=e,[this.coordinate.lat,this.coordinate.lon]=Object(p["c"])(t,e)},onBounds(t){this.bounds=t,this.min.lat=t.min.wgs.lat,this.min.lon=t.min.wgs.lon,this.max.lat=t.max.wgs.lat,this.max.lon=t.max.wgs.lon},onLVCoord(t){console.log("extract/App.vue#onLVCoord: ",t);const e=this.coordinate;[e.lat,e.lon,e.N,e.E]=[t.wgs.lat,t.wgs.lon,t.lv95.N,t.lv95.E]}},watch:{coordinate:{handler(){this.$emit("coord-bounds-change",{coordinate:this.coordinate,bounds:this.bounds})},deep:!0},min:{handler(){this.$emit("coord-bounds-change",{coordinate:this.coordinate,min:this.min,max:this.max})},deep:!0},max:{handler(){this.$emit("coord-bounds-change",{coordinate:this.coordinate,min:this.min,max:this.max})},deep:!0}}};n("7921");x.render=u,x.__scopeId="data-v-01fbb576";var b=x;class f{constructor(t,e){this.fileLoaderElt=t,this.fileLoaderElt.addEventListener("change",()=>{this.onFileSelected()},!1),this.loadCb=e}onFileSelected(){const t=this.fileLoaderElt.files[0],e=new FileReader;e.onload=t=>{const e=t.target.result,n=e.toString().split(",")[1],o=atob(n);this.loadCb(o)},e.readAsDataURL(t)}}class g{constructor(t,e,n,o){this.xyzObject=t,this.onZoomChangeCb=o;const i=e.min.x,s=e.min.y,r=e.max.x,a=e.max.y,c=r-i,h=a-s;Math.max(c,h);this.userSelection=null}processBounds(t,e){let n=!1;if(t.hasOwnProperty("Radius"))if(v(t.X)&&v(t.Y)&&Number.isFinite(t.Radius)&&t.Radius>0){parseFloat(t.X),parseFloat(t.Y);const o=parseFloat(t.Radius);this.userSelection={Xmin:t.X-o,Ymin:t.Y-o,Xmax:t.X+o,Ymax:t.Y+o},this.activateDownloadButton(e,t),n=!0}else this.deactivateDownloadButton(e);else v(t.Xmin)&&v(t.Ymin)&&y(t.Xmax,t.Xmin)&&y(t.Ymax,t.Ymin)?(this.userSelection=t,this.activateDownloadButton(e,t),n=!0):this.deactivateDownloadButton(e);n&&requestAnimationFrame(()=>{this.onZoomChangeCb(this.userSelection)})}activateDownloadButton(t,e){t.onclick=()=>{this.processBounds(e,t);const n=this.xyzObject.extractSectionAsXYZ(this.userSelection),o=new Blob([n],{type:"text/plain"}),i=window.URL.createObjectURL(o);t.href=i},t.setAttribute("href","")}deactivateDownloadButton(t){t.onclick=null,t.removeAttribute("href")}}function y(t,e){return void 0===e&&(e=0),Number.isFinite(t)&&t>e}function v(t,e){return void 0===e&&(e=0),Number.isFinite(t)&&t>=e}var j=n("5a89"),B=n("4721");class O{constructor(t){if(t.length<3||t.length%3!=0)throw new Error("Source array length must be mulitples of 3 and >= 3, but is: "+t.length);this.sourceArray=t}computeArrayShape(){const t=this.sourceArray,e=t.length/3;let n=t[1],o=e,i=1;for(let s=3;s<t.length;s+=3){const r=t[s+1];if(r!=n){o=s/3,i=e/o;break}}return[o,i]}fixupArray(t,e,n,o,i,s){const r=new Float32Array(3);t.splice(e,0,...r)}transferXYZ(t){const e=this.sourceArray;let n=e[1],o=0;for(let i=0;i<e.length&&i<t.length;i+=3){o++;const s=i,r=i+1,a=i+2,c=(e[s],e[r]);e[a];c!=n&&(o=0,n=c),t[s]=e[s],t[r]=e[r],t[a]=e[a]}}}class A extends j["p"]{constructor(t,e=!0){if(super(),this.origArr=[...t.attributes.position.array],this.srcArr=new O(this.origArr),isNaN(this.origArr[0]))throw console.log(this.origArr,this.srcArr),new Error("Bogus data in source geometry.. found NaNs");const n=new j["b"];t.computeBoundingBox(),n.copy(t.boundingBox),this.shape=e?S(this.srcArr.sourceArray,n):z(this.srcArr,n),this.add(this.shape)}extractSectionAsXYZ(t){const e=this.origArr,n=[`# ${new Date}, exported from XYZ tool`];for(let o=0;o<e.length;o+=3){const i=e[o],s=e[o+1],r=e[o+2];i<t.Xmin||s<t.Ymin||i>t.Xmax||s>t.Ymax||n.push(`${i} ${s} ${r}`)}return n.push(""),n.join("\n")}showSection(t,e,n,o){null==this.section&&(this.section=this.cutSection(t,e,n,o)),this.add(this.section)}}function S(t,e){const n=t.length/3,o=new Float32Array(t.length),i=new Float32Array(t.length),s=new Float32Array(n);for(let h=0;h<t.length;h+=3){const e=h,n=h+1,r=h+2;o[e]=t[e],o[n]=t[n],o[r]=t[r],i[n]=255,s[h/3]=1}const r=new j["e"];r.setAttribute("position",new j["d"](o,3)),r.setAttribute("size",new j["d"](s,1)),r.computeBoundingBox(),r.center();const a=new j["u"]({color:34816,sizeAttenuation:!1,size:10}),c=new j["t"](r,a);return c.sortParticles=!0,c.sourceBounds=e,c.viewBounds=r.boundingBox,c.rotateX(Math.PI/-2),c}function z(t,e){const[n,o]=t.computeArrayShape(),i=new j["r"](n,o,n-1,o-1),s=i.getAttribute("position"),r=s.array;t.transferXYZ(r),i.center(),i.computeBoundingBox(),i.computeFaceNormals(),i.computeVertexNormals();const a=new j["m"](i,new j["o"]({color:"green",side:j["g"],shininess:10,wireframe:!1}));return a.receiveShadow=!0,a.sourceBounds=e,a.viewBounds=i.boundingBox,a.rotateX(Math.PI/-2),a}const C=.3;class X extends j["w"]{constructor(t=document.querySelector("#view"),e=null){if(super(),!t)throw new Error("View container not found");this.container=t,this.animCb=e,this.width=t.innerWidth,this.height=t.innerHeight,this.camera=new j["q"](45,this.width/this.height,.1,1e10),this.camera.position.set(0,30,150),this.add(this.camera),this.add(new j["a"]);const n=6357e3,o=new j["m"](new j["x"](n,120,60),new j["o"]({flatShading:!1,wireframe:!0,color:11206570})),i=10;o.position.set(0,-n-i,0),o.rotateX(Math.PI/2),this.add(o),this.background=new j["f"](12571109);const s=new j["s"];s.castShadow=!0,s.intensity=C,s.shadow.camera.near=.5,s.shadow.camera.far=250,s.shadow.camera.width=256,s.shadow.camera.height=256,s.position.set(-50,1e6,-50),this.add(s),this.light=s;const a=s.clone();a.castShadow=!1,a.intensity=1-C,this.add(a),this.renderer=new j["C"]({antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.setSize(this.width,this.height),t.appendChild(this.renderer.domElement),this.controls=new B["a"](this.camera,this.renderer.domElement),this.fs=new r["a"](t,()=>{this.onWindowResize()}),this.onWindowResize(),window.addEventListener("resize",()=>{this.onWindowResize()}),this.animate(),document.view=this,this.zoomBox=null}displayXYZObject(t){this.xyzObj&&this.remove(this.xyzObj),this.add(t),this.xyzObj=t,this.light.target=t}focus(t){if(null==t)throw new Error("zoomBoundsIn null");const e={min:{x:t.Xmin,y:t.Ymin},max:{x:t.Xmax,y:t.Ymax}},n=this.xyzObj.children[0].sourceBounds,o=n.max.x-n.min.x,i=n.max.y-n.min.y,s=this.xyzObj.children[0].viewBounds,r=s.max.x-s.min.x,a=s.max.y-s.min.y,c=s.min.x,h=s.min.y,d=e.min.x,l=e.min.y,u=e.max.x-e.min.x,m=e.max.y-e.min.y,w=1,p=s.max.z-s.min.z+w,x=d-n.min.x,b=l-n.min.y,f=u/o*r,g=p,y=m/i*a,v=new j["c"](f,g,y);v.center();const B=new j["n"]({color:16777215,transparent:!0,opacity:C}),O=new j["m"](v,B);O.castShadow=!0,O.receiveShadow=!0;const A=O.clone();A.castShadow=!1,A.receiveShadow=!1,A.material=new j["n"]({color:13421823,transparent:!0,opacity:C,wireframe:!0}),O.add(A),this.zoomBox&&this.remove(this.zoomBox),this.add(this.zoomBox=O),O.position.x=c+x+f-f/2,O.position.z=-h-b-y+y/2,O.position.y-=w/2}animate(){this.controls.update(),this.renderer.render(this,this.camera),this.animCb&&this.animCb(this),requestAnimationFrame(()=>{this.animate()})}onWindowResize(){this.fs.isFullscreen()?(this.width=window.innerWidth,this.height=window.innerHeight):(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}}n("7dcc");let Y;i["a"](),new r["a"](document.getElementById("view")),console.log("permalink in extract/index: ",s["a"]);const E=new X;let F;const L=o["b"]({components:{"extract-tool":b},data(){const t={coordinate:{lat:s["a"].lat,lon:s["a"].lon,N:s["a"].lat,E:s["a"].lon},min:{lat:s["a"].min_lat,lon:s["a"].min_lon},max:{lat:s["a"].max_lat,lon:s["a"].max_lon}};return t},created(){F=this,window.comp=F},methods:{setCoord(t,e,n){console.log("index.js#init",this.coordinate,this.min,this.max),this.onCoordBounds({coordinate:this.coordinate,min:this.min,max:this.max})},onCoordBounds(t){const e=t.min,n=t.max,o=Object(p["d"])(e.lat,e.lon),i=Object(p["d"])(n.lat,n.lon);console.log("coord-bounds-change: ",o,i);const s={Xmin:o[1],Xmax:i[1],Ymin:o[0],Ymax:i[0]};console.log("extract/index.js:calling zoom: ",s),E.focus(s),Y.processBounds(s,document.getElementById("dlbtn"))}},watch:{coord:{handler(){console.log("extract/index.js#coord handler",this.coordinate)},deep:!0}}});L.mount("#app");const N=t=>{const e=new A(t);E.displayXYZObject(e);const n=e.shape.sourceBounds;if(Y=new g(e,e.shape.sourceBounds,e.shape.viewBounds,t=>{}),F){const t=n.min.y+(n.max.y-n.min.y)/2,e=n.min.x+(n.max.x-n.min.x)/2;F.setCoord(t,e,1)}},P=document.querySelector("select[name='sources']");P.addEventListener("change",()=>{(new a["a"]).load(P.value,N)}),(new a["a"]).load(P.value,N);const R=document.getElementById("fileLoader");new f(R,t=>{N((new a["a"]).parse(t))});function _(){location.hash.substr(1)}window.addEventListener("hashchange",_),_()},7921:function(t,e,n){"use strict";n("ef58")},ef58:function(t,e,n){}});
//# sourceMappingURL=extract.117e87c6.js.map