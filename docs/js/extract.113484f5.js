(function(t){function e(e){for(var o,r,a=e[0],c=e[1],d=e[2],l=0,u=[];l<a.length;l++)r=a[l],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&u.push(i[r][0]),i[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);h&&h(e);while(u.length)u.shift()();return s.push.apply(s,d||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],o=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(o=!1)}o&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var o={},i={extract:0},s=[];function r(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=o,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/xyz/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=e,a=a.slice();for(var d=0;d<a.length;d++)e(a[d]);var h=c;s.push([2,"chunk-vendors","chunk-common"]),n()})({2:function(t,e,n){t.exports=n("5b37")},"5b37":function(t,e,n){"use strict";n.r(e);var o=n("f2bf"),i=n("05a8"),s=n("a911"),r=n("6bdf"),a=n("b1d2");const c=Object(o["o"])("data-v-78e27a06");Object(o["h"])("data-v-78e27a06");const d={class:"coords-bounds-form"},h=Object(o["e"])("a",{id:"dlbtn",class:"button",download:"extract.xyz"},"Download",-1),l=Object(o["e"])("h3",null,"Center Point Coordinate",-1);Object(o["g"])();const u=c((t,e,n,i,s,r)=>{const a=Object(o["j"])("coords-form"),c=Object(o["j"])("bounds-form");return Object(o["f"])(),Object(o["c"])("div",d,[h,l,Object(o["e"])(a,{coordinate:n.coordinate,onCoordChanged:r.onLVCoord},null,8,["coordinate","onCoordChanged"]),Object(o["e"])(c,{min:n.min,max:n.max,onBoundsChanged:r.onBounds},null,8,["min","max","onBoundsChanged"])])});var m=n("5110"),w=n("3fd7"),p={props:{coordinate:Object,min:Object,max:Object},components:{CoordsForm:m["a"],BoundsForm:w["a"]},methods:{onBounds(t){this.bounds=t,this.min.lat=t.min.lat,this.min.lon=t.min.lon,this.max.lat=t.max.lat,this.max.lon=t.max.lon},onLVCoord(t){console.log("extract/App.vue#onLVCoord: ",t);const e=this.coordinate;[e.lat,e.lon]=[t.lat,t.lon]}},watch:{coordinate:{handler(){this.$emit("coord-bounds-change",{coordinate:this.coordinate,bounds:this.bounds})},deep:!0},min:{handler(){this.$emit("coord-bounds-change",{coordinate:this.coordinate,min:this.min,max:this.max})},deep:!0},max:{handler(){this.$emit("coord-bounds-change",{coordinate:this.coordinate,min:this.min,max:this.max})},deep:!0}}};n("f363");p.render=u,p.__scopeId="data-v-78e27a06";var x=p;class f{constructor(t,e){this.fileLoaderElt=t,this.fileLoaderElt.addEventListener("change",()=>{this.onFileSelected()},!1),this.loadCb=e}onFileSelected(){const t=this.fileLoaderElt.files[0],e=new FileReader;e.onload=t=>{const e=t.target.result,n=e.toString().split(",")[1],o=atob(n);this.loadCb(o)},e.readAsDataURL(t)}}class b{constructor(t,e,n,o,i){this.xyzObject=t,this.centerPointCoordinate=e,this.onZoomChangeCb=i;const s=n.min.x,r=n.min.y,a=n.max.x,c=n.max.y,d=a-s,h=c-r;Math.max(d,h);this.userSelection=null}processBounds(t,e){let n=!1;if(t.hasOwnProperty("Radius"))if(v(t.X)&&v(t.Y)&&Number.isFinite(t.Radius)&&t.Radius>0){parseFloat(t.X),parseFloat(t.Y);const o=parseFloat(t.Radius);this.userSelection={Xmin:t.X-o,Ymin:t.Y-o,Xmax:t.X+o,Ymax:t.Y+o},this.activateDownloadButton(e,t),n=!0}else this.deactivateDownloadButton(e);else v(t.Xmin)&&v(t.Ymin)&&y(t.Xmax,t.Xmin)&&y(t.Ymax,t.Ymin)?(this.userSelection=t,this.activateDownloadButton(e,t),n=!0):this.deactivateDownloadButton(e);n&&requestAnimationFrame(()=>{this.onZoomChangeCb(this.userSelection)})}activateDownloadButton(t,e){t.onclick=()=>{this.processBounds(e,t);let n=this.xyzObject.extractSectionAsXYZ(this.userSelection);n=g(n,this.centerPointCoordinate);const o=new Blob([n],{type:"text/plain"}),i=window.URL.createObjectURL(o);t.href=i},t.setAttribute("href","")}deactivateDownloadButton(t){t.onclick=null,t.removeAttribute("href")}}function g(t,e){const n=t.split("\n"),o=[];console.log("centerPointCoordinate",e);for(let i of n)if(i=i.trim(),"#"===i.charAt(0))o.push(i);else{let t=i.split(/\s+/),n=t[0],s=t[1];isNaN(n)||isNaN(s)?console.log("Unexpected data: not a number",n,s):(t[0]=n-e.E,t[1]=s-e.N),console.log("x, y, lineValues[0], lineValues[1], centerPointCoordinate.E, centerPointCoordinate.N",n,s,t[0],t[1],e.E,e.N);const r=t.join(" ");o.push(r)}return o.join("\n")}function y(t,e){return void 0===e&&(e=0),Number.isFinite(t)&&t>e}function v(t,e){return void 0===e&&(e=0),Number.isFinite(t)&&t>=e}var j=n("5a89"),B=n("4721");class O{constructor(t){if(t.length<3||t.length%3!=0)throw new Error("Source array length must be mulitples of 3 and >= 3, but is: "+t.length);this.sourceArray=t}computeArrayShape(){const t=this.sourceArray,e=t.length/3;let n=t[1],o=e,i=1;for(let s=3;s<t.length;s+=3){const r=t[s+1];if(r!=n){o=s/3,i=e/o;break}}return[o,i]}fixupArray(t,e,n,o,i,s){const r=new Float32Array(3);t.splice(e,0,...r)}transferXYZ(t){const e=this.sourceArray;let n=e[1],o=0;for(let i=0;i<e.length&&i<t.length;i+=3){o++;const s=i,r=i+1,a=i+2,c=(e[s],e[r]);e[a];c!=n&&(o=0,n=c),t[s]=e[s],t[r]=e[r],t[a]=e[a]}}}class S extends j["p"]{constructor(t,e=!0){if(super(),this.origArr=[...t.attributes.position.array],this.srcArr=new O(this.origArr),isNaN(this.origArr[0]))throw console.log(this.origArr,this.srcArr),new Error("Bogus data in source geometry.. found NaNs");const n=new j["b"];t.computeBoundingBox(),n.copy(t.boundingBox),this.shape=e?A(this.srcArr.sourceArray,n):C(this.srcArr,n),this.add(this.shape)}extractSectionAsXYZ(t){const e=this.origArr,n=[`# ${new Date}, exported from XYZ tool`];for(let o=0;o<e.length;o+=3){const i=e[o],s=e[o+1],r=e[o+2];i<t.Xmin||s<t.Ymin||i>t.Xmax||s>t.Ymax||n.push(`${i} ${s} ${r}`)}return n.push(""),n.join("\n")}showSection(t,e,n,o){null==this.section&&(this.section=this.cutSection(t,e,n,o)),this.add(this.section)}}function A(t,e){const n=t.length/3,o=new Float32Array(t.length),i=new Float32Array(t.length),s=new Float32Array(n);for(let d=0;d<t.length;d+=3){const e=d,n=d+1,r=d+2;o[e]=t[e],o[n]=t[n],o[r]=t[r],i[n]=255,s[d/3]=1}const r=new j["e"];r.setAttribute("position",new j["d"](o,3)),r.setAttribute("size",new j["d"](s,1)),r.computeBoundingBox(),r.center();const a=new j["u"]({color:34816,sizeAttenuation:!1,size:2}),c=new j["t"](r,a);return c.sortParticles=!0,c.sourceBounds=e,c.viewBounds=r.boundingBox,c.rotateX(Math.PI/-2),c}function C(t,e){const[n,o]=t.computeArrayShape(),i=new j["r"](n,o,n-1,o-1),s=i.getAttribute("position"),r=s.array;t.transferXYZ(r),i.center(),i.computeBoundingBox(),i.computeFaceNormals(),i.computeVertexNormals();const a=new j["m"](i,new j["o"]({color:"green",side:j["g"],shininess:10,wireframe:!1}));return a.receiveShadow=!0,a.sourceBounds=e,a.viewBounds=i.boundingBox,a.rotateX(Math.PI/-2),a}const z=.3;class X extends j["w"]{constructor(t=document.querySelector("#view"),e=null){if(super(),!t)throw new Error("View container not found");this.container=t,this.animCb=e,this.width=t.innerWidth,this.height=t.innerHeight,this.camera=new j["q"](45,this.width/this.height,.1,1e10),this.camera.position.set(0,30,150),this.add(this.camera),this.add(new j["a"]);const n=6357e3,o=new j["m"](new j["x"](n,120,60),new j["o"]({flatShading:!1,wireframe:!0,color:11206570})),i=10;o.position.set(0,-n-i,0),o.rotateX(Math.PI/2),this.add(o),this.background=new j["f"](12571109);const s=new j["s"];s.castShadow=!0,s.intensity=z,s.shadow.camera.near=.5,s.shadow.camera.far=250,s.shadow.camera.width=256,s.shadow.camera.height=256,s.position.set(-50,1e6,-50),this.add(s),this.light=s;const a=s.clone();a.castShadow=!1,a.intensity=1-z,this.add(a),this.renderer=new j["C"]({antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.setSize(this.width,this.height),t.appendChild(this.renderer.domElement),this.controls=new B["a"](this.camera,this.renderer.domElement),this.fs=new r["a"](t,()=>{this.onWindowResize()}),this.onWindowResize(),window.addEventListener("resize",()=>{this.onWindowResize()}),this.animate(),document.view=this,this.zoomBox=null}displayXYZObject(t){this.xyzObj&&this.remove(this.xyzObj),this.add(t),this.xyzObj=t,this.light.target=t}focus(t){if(null==t)throw new Error("zoomBoundsIn null");const e={min:{x:t.Xmin,y:t.Ymin},max:{x:t.Xmax,y:t.Ymax}},n=this.xyzObj.children[0].sourceBounds,o=n.max.x-n.min.x,i=n.max.y-n.min.y,s=this.xyzObj.children[0].viewBounds,r=s.max.x-s.min.x,a=s.max.y-s.min.y,c=s.min.x,d=s.min.y,h=e.min.x,l=e.min.y,u=e.max.x-e.min.x,m=e.max.y-e.min.y,w=1,p=s.max.z-s.min.z+w,x=h-n.min.x,f=l-n.min.y,b=u/o*r,g=p,y=m/i*a,v=new j["c"](b,g,y);v.center();const B=new j["n"]({color:16777215,transparent:!0,opacity:z}),O=new j["m"](v,B);O.castShadow=!0,O.receiveShadow=!0;const S=O.clone();S.castShadow=!1,S.receiveShadow=!1,S.material=new j["n"]({color:13421823,transparent:!0,opacity:z,wireframe:!0}),O.add(S),this.zoomBox&&this.remove(this.zoomBox),this.add(this.zoomBox=O),O.position.x=c+x+b-b/2,O.position.z=-d-f-y+y/2,O.position.y-=w/2}animate(){this.controls.update(),this.renderer.render(this,this.camera),this.animCb&&this.animCb(this),requestAnimationFrame(()=>{this.animate()})}onWindowResize(){this.fs.isFullscreen()?(this.width=window.innerWidth,this.height=window.innerHeight):(this.width=this.container.offsetWidth,this.height=this.container.offsetHeight),this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}}var Y=n("ea67");n("7dcc");let E;i["a"](),new r["a"](document.getElementById("view")),console.log("permalink in extract/index: ",s["a"]);const F=new X;let P;const N=o["b"]({components:{"extract-tool":x},data(){const t={coordinate:{lat:s["a"].lat,lon:s["a"].lon,system:Y["a"].WGS84,N:0,E:0},min:{lat:s["a"].min_lat,lon:s["a"].min_lon,system:Y["a"].WGS84},max:{lat:s["a"].max_lat,lon:s["a"].max_lon,system:Y["a"].WGS84}};return t},created(){P=this,window.comp=P;const t=Object(Y["e"])(s["a"].lat,s["a"].lon);this.coordinate.N=t[0],this.coordinate.E=t[1]},methods:{setCoord(t,e,n){console.log("index.js#init",this.coordinate,this.min,this.max),this.onCoordBounds({coordinate:this.coordinate,min:this.min,max:this.max})},onCoordBounds(t){const e=t.min,n=t.max,o=Object(Y["e"])(e.lat,e.lon),i=Object(Y["e"])(n.lat,n.lon),s={Xmin:o[1],Xmax:i[1],Ymin:o[0],Ymax:i[0]};F.focus(s),E.processBounds(s,document.getElementById("dlbtn"))}},watch:{coord:{handler(){console.log("extract/index.js#coord handler",this.coordinate)},deep:!0}}});N.mount("#app");const L=t=>{const e=new S(t);F.displayXYZObject(e);const n=e.shape.sourceBounds;if(P){const t=P.coordinate;E=new b(e,t,e.shape.sourceBounds,e.shape.viewBounds,t=>{});const o=n.min.y+(n.max.y-n.min.y)/2,i=n.min.x+(n.max.x-n.min.x)/2;P.setCoord(o,i,1)}},R=document.querySelector("select[name='sources']");R.addEventListener("change",()=>{const t=W(R.value);(new a["a"]).load(t,L)});const _=W(R.value);(new a["a"]).load(_,L);const M=document.getElementById("fileLoader");new f(M,t=>{const e=W(t);L((new a["a"]).parse(e))});function W(t){const e=/(\d+\.?\d*)\s+(\d+\.?\d*)\s+(\d+\.?\d*).*/g,n=t.search(e),o=t.substring(n);return console.log("trimmed",o),o}function k(){location.hash.substr(1)}window.addEventListener("hashchange",k),k()},f363:function(t,e,n){"use strict";n("ff7a")},ff7a:function(t,e,n){}});
//# sourceMappingURL=extract.113484f5.js.map