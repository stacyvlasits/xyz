{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/index/App.vue?46e2","webpack:///src/index/App.vue","webpack:///./src/index/App.vue?8223","webpack:///./src/index/App.vue","webpack:///./src/index/FileLoaderControl.js","webpack:///./src/index/SelectionControl.js","webpack:///./src/index/XYZArray.js","webpack:///./src/index/XYZObject.js","webpack:///./src/index/View.js","webpack:///./src/index/index.js","webpack:///./src/coords/coords.js","webpack:///./src/coords/CoordsForm.vue?6f77","webpack:///src/coords/CoordsForm.vue","webpack:///./src/coords/CoordsForm.vue?0be1","webpack:///./src/coords/CoordsForm.vue"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","render","_vm","this","_h","$createElement","_c","_self","attrs","initCoord","initLv","on","$event","onLVCoord","_v","directives","rawName","expression","domProps","radius","target","composing","staticClass","staticRenderFns","component","FileLoaderControl","fileLoaderElt","loadCb","addEventListener","onFileSelected","file","files","reader","FileReader","onload","content","arr","base64","toString","split","decoded","atob","readAsDataURL","SelectionControl","xyzObject","sourceBounds","viewBounds","onZoomChangeCb","minX","min","x","minY","y","maxX","max","maxY","width","height","Math","userSelection","bounds","button","isBoundsValid","gte","X","Y","Number","isFinite","Radius","parseFloat","Xmin","Ymin","Xmax","Ymax","activateDownloadButton","deactivateDownloadButton","gt","requestAnimationFrame","onclick","processBounds","fileContent","extractSectionAsXYZ","Blob","type","url","URL","createObjectURL","href","setAttribute","removeAttribute","a","b","undefined","XYZArray","sourceArray","Error","src","numPoints","lastY","numX","numY","offset","curNumX","curNumY","toInsert","Float32Array","dst","y0","yCount","xi","yi","zi","geometry","usePoints","super","origArr","attributes","position","array","srcArr","computeBoundingBox","copy","boundingBox","shape","toPointsShape","toShape","add","lines","Date","z","join","xMin","xMax","yMin","yMax","section","cutSection","xyzArr","coords","colors","sizes","geom","center","groundMaterial","color","sizeAttenuation","size","groundPoints","sortParticles","rotateX","PI","computeArrayShape","geom2","getAttribute","vertices","transferXYZ","computeFaceNormals","computeVertexNormals","obj","side","shininess","wireframe","receiveShadow","zoomBoxOpacity","container","document","querySelector","animCb","innerWidth","innerHeight","camera","set","globe","flatShading","altitudeOffset","background","light","castShadow","intensity","shadow","near","far","shadowLight","clone","renderer","antialias","shadowMap","enabled","setSize","appendChild","domElement","controls","fs","onWindowResize","animate","view","zoomBox","xyzObj","remove","zoomBoundsIn","zoomBounds","children","sourceWidth","sourceDepth","viewWidth","viewDepth","viewXOff","viewYOff","zoomX","zoomY","zoomWidth","zoomDepth","ZOOM_EXTRA","zoomHeight","boxX","boxY","boxWidth","boxHeight","boxDepth","material","transparent","opacity","box","wireBox","update","isFullscreen","offsetWidth","offsetHeight","aspect","updateProjectionMatrix","sc","vm","el","h","App","methods","N","E","R","$children","setLv95","setRadius","$on","e","coord","zoom","focus","getElementById","display","displayXYZObject","setLv95AndRadius","selectElt","XYZLoader","load","loadedXyz","parse","handleHash","location","hash","substr","π","τ","sqrt","sin","exp","log","cos","DEGREE","tan","asin","atan","MINUTE","SECOND","dms2deg","deg","sec","deg2rad","deg2dms","degIn","floor","minIn","wgs2lv95","latt","lngg","latArc","lngArc","lat","lng","lat2","lat3","lng2","lng3","toFixed","lv952wgs","Ep","Np","xp","yp","xp2","xp3","yp2","yp3","λp","φp","λ","φ","Ellipsoid","semiMajor","semiMinor","φ0","λ0","flatteningInverse","E2","radiusOfProjectionSphere","α","sin2","cos4","θ","BesselEllipsoid","onSelect","dms","$set","lon","lv95","ESlider","NSlider","props","show","latDeg","latMin","latSec","lonDeg","lonMin","lonSec","nMin","MIN_VALUE","nMax","MAX_VALUE","eMin","eMax","latMax","lonMax","watch","lv","changeEvent","wgs","$root","$emit","deep","rangeN","rangeE"],"mappings":"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","file":"js/index.4f0eff52.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"index\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('coords-form',{attrs:{\"init-coord\":_vm.initCoord,\"init-lv\":_vm.initLv},on:{\"coord-changed\":function($event){return _vm.onLVCoord($event)}}}),_c('form',[_c('table',[_c('tr',[_c('td',[_vm._v(\"Radius:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.radius),expression:\"radius\"}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"100\",\"step\":\"0.5\"},domProps:{\"value\":(_vm.radius)},on:{\"__r\":function($event){_vm.radius=$event.target.value}}})]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.radius),expression:\"radius\"}],attrs:{\"type\":\"number\",\"step\":\"0.5\"},domProps:{\"value\":(_vm.radius)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.radius=$event.target.value}}})])])]),_c('a',{staticClass:\"button\",attrs:{\"id\":\"dlbtn\",\"download\":\"extract.xyz\"}},[_vm._v(\"Download\")])])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n<div>\n  <coords-form v-on:coord-changed=\"onLVCoord($event)\"\n               v-bind:init-coord=\"initCoord\"\n               v-bind:init-lv=\"initLv\"></coords-form>\n  <form>\n    <table>\n      <tr>\n        <td>Radius:</td>\n        <td><input v-model=\"radius\" type=\"range\" min=\"0\" max=\"100\" step=\"0.5\"></td>\n        <td><input v-model=\"radius\" type=\"number\" step=\"0.5\"></td>\n      </tr>\n    </table>\n    <a id=\"dlbtn\" class=\"button\" download=\"extract.xyz\">Download</a>\n  </form>\n</div>\n</template>\n<script>\n  import CoordsForm from '../coords/CoordsForm.vue';\n  export default {\n    components: {\n      'coords-form': CoordsForm\n    },\n    methods: {\n      setLatLon(lat, lon) {\n        this.$children[0].setLatLon(lat, lon);\n      },\n      setLv95(N, E) {\n        this.$children[0].setLv95(N, E);\n      },\n      setRadius(r) {\n        this.radius = r;\n      },\n      onLVCoord(ev) {\n        const c = this.coord;\n        [c.lat, c.lon, c.N, c.E] = [ev.wgs.lat, ev.wgs.lon, ev.lv95.N, ev.lv95.E];\n      }\n    },\n    data() {\n      return {\n        initCoord: {\n          lat: 46.951082773,\n          lon: 7.438632421,\n          latDeg: 46,\n          latMin: 57,\n          latSec: 3.89798,\n          lonDeg: 7,\n          lonMin: 26,\n          lonSec: 19.07672,\n        },\n        initLv: {\n          N: 1200000,\n          E: 2600000,\n          nMin: 1242525.25,\n          nMax: 1242594.75,\n          eMin: 2683475.25,\n          eMax: 2683539.75\n        },\n        coord: {\n          lat: 46.951082773,\n          lon: 7.438632421,\n          N: 1200000,\n          E: 2600000\n        },\n        radius: 10\n      }\n    },\n    watch: {\n      coord: {\n        handler() {\n          this.$root.$emit('coord-radius-change',\n                           {coord: this.coord, radius: parseFloat(this.radius)});\n        },\n        deep: true\n      },\n      radius: {\n        handler() {\n          this.$root.$emit('coord-radius-change',\n                           {coord: this.coord, radius: parseFloat(this.radius)});\n        }\n      }\n    }\n  }\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=af65c49e&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export default class FileLoaderControl {\n  constructor(fileLoaderElt, loadCb) {\n    this.fileLoaderElt = fileLoaderElt;\n    this.fileLoaderElt.addEventListener('change', () => {\n        this.onFileSelected();\n      }, false);\n    this.loadCb = loadCb;\n  }\n\n\n  onFileSelected() {\n    const file = this.fileLoaderElt.files[0];\n    const reader = new FileReader();\n    reader.onload = content => {\n      const arr = content.target.result;\n      const base64 = arr.toString().split(',')[1];\n      const decoded = atob(base64);\n      this.loadCb(decoded);\n    };\n    reader.readAsDataURL(file);\n  }\n}\n","/**\n * Setup the input sliders and text fields with min/max bounds.\n */\nexport default class SelectionControl {\n  constructor(xyzObject, sourceBounds, viewBounds, onZoomChangeCb) {\n    this.xyzObject = xyzObject;\n    this.onZoomChangeCb = onZoomChangeCb;\n    const minX = sourceBounds.min.x;\n    const minY = sourceBounds.min.y;\n    const maxX = sourceBounds.max.x;\n    const maxY = sourceBounds.max.y;\n    const width = maxX - minX;\n    const height = maxY - minY;\n    const maxRadius = Math.max(width, height) / 2;\n    // These max values must be >0 and a number.\n    const radiusParams = {\n      X: [minX, maxX],\n      Y: [minY, maxY],\n      Radius: [0, maxRadius]\n    };\n\n    const boxParams = {\n      Xmin: [minX, maxX],\n      Ymin: [minY, maxY],\n      Xmax: [minX, maxX],\n      Ymax: [minY, maxY]\n    };\n\n    this.userSelection = null;\n  }\n\n\n  processBounds(bounds, button) {\n    let boxBounds = bounds;\n    let isBoundsValid = false;\n    if (bounds.hasOwnProperty('Radius')) {\n      if (gte(bounds.X)\n          && gte(bounds.Y)\n          && Number.isFinite(bounds.Radius)\n          && bounds.Radius > 0) {\n        const x = parseFloat(bounds.X);\n        const y = parseFloat(bounds.Y);\n        const r = parseFloat(bounds.Radius);\n        this.userSelection = {\n          Xmin: bounds.X - r,\n          Ymin: bounds.Y - r,\n          Xmax: bounds.X + r,\n          Ymax: bounds.Y + r\n        };\n        this.activateDownloadButton(button, bounds);\n        isBoundsValid = true;\n      } else {\n        this.deactivateDownloadButton(button);\n      }\n    } else {\n      if (gte(bounds.Xmin)\n          && gte(bounds.Ymin)\n          && gt(bounds.Xmax, bounds.Xmin)\n          && gt(bounds.Ymax, bounds.Ymin)) {\n        this.userSelection = bounds;\n        this.activateDownloadButton(button, bounds);\n        isBoundsValid = true;\n      } else {\n        this.deactivateDownloadButton(button);\n      }\n    }\n    if (isBoundsValid) {\n      requestAnimationFrame(() => {\n        this.onZoomChangeCb(this.userSelection);\n      });\n    }\n  }\n\n\n  activateDownloadButton(button, bounds) {\n    button.onclick = () => {\n      this.processBounds(bounds, button);\n      const fileContent = this.xyzObject.extractSectionAsXYZ(this.userSelection);\n      const data = new Blob([fileContent], {type: 'text/plain'});\n      const url = window.URL.createObjectURL(data);\n      button.href = url;\n    }\n    button.setAttribute('href', '');\n  }\n\n\n  deactivateDownloadButton(button) {\n    button.onclick = null;\n    button.removeAttribute('href');\n  }\n}\n\n\nfunction clip(min, max, val) {\n  return Math.min(Math.max(val, min), max);\n}\n\n\n/** @return true Iff a is a finite number and a > b. */\nfunction gt(a, b) {\n  if (b === undefined) {\n    b = 0;\n  }\n  return Number.isFinite(a) && a > b;\n}\n\n\n/** @return true Iff a is a finite number and a > b. */\nfunction gte(a, b) {\n  if (b === undefined) {\n    b = 0;\n  }\n  return Number.isFinite(a) && a >= b;\n}\n","export default class XYZArray {\n  constructor(sourceArray) {\n    if (sourceArray.length < 3 || sourceArray.length % 3 != 0) {\n      throw new Error('Source array length must be mulitples of 3 and >= 3, but is: ' + sourceArray.length);\n    }\n    this.sourceArray = sourceArray;\n  }\n\n\n  computeArrayShape() {\n    const src = this.sourceArray;\n    const numPoints = src.length / 3;\n    let lastY = src[1]; // TODO: assumes data sorted by Y\n    let first = true, numX = numPoints, numY = 1;\n    // First, scan the array to see what the X dimension is from the\n    // first column.\n    for (let i = 3; i < src.length; i += 3) {\n      const y = src[i + 1];\n      if (y != lastY) {\n        numX = i / 3;\n        numY = numPoints / numX;\n        break;\n      }\n    }\n    //console.log(`after scan numX:${numX} numY:${numY}`);\n    if (true) {\n      return [numX, numY];\n    }\n    // Now, find bounding box.\n    let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n    for (let i = 0; i < src.length; i += 3) {\n      const x = src[i];\n      const y = src[i + 1];\n      minX = Math.min(minX, x);\n      minY = Math.min(minY, y);\n      maxX = Math.max(maxX, x);\n      maxY = Math.max(maxY, y);\n    }\n    if (minX == Infinity || minY == Infinity || maxX == -Infinity || maxY == -Infinity) {\n      throw new Error(`Unbounded data in array: minX:${minX} minY:${minY} maxX:${maxX} maxY:${maxY}`);\n    }\n    console.log(`bounds minX:${minX} minY:${minY} maxX:${maxX} maxY:${maxY}`);\n\n    for (let i = 3; i < src.length; i += 3) {\n      const y = src[i + 1];\n      if (y != lastY) {\n        if (first) {\n          first = false;\n          numX = i / 3;\n          numY = numPoints / numX;\n        } else {\n          const newNumX = i / 3;\n          const newNumY = numPoints / numX;\n          if (newNumX != numX)\n            console.log(`i:${i} newNumX:${newNumX} != numX:${numX}`);\n          if (newNumY != numY)\n            console.log(`$:${i} newNumY:${newNumY} != numX:${numY}`);\n          //this.fixupArray(src, numX, numY, newNumX, newNumY);\n          throw new Error('Sparse data');\n        }\n      }\n    }\n    console.log(`numX:${numX} numY:${numY}`);\n    return [numX, numY];\n  }\n\n\n  fixupArray(arr, offset, numX, numY, curNumX, curNumY) {\n    const toInsert = new Float32Array(3 * 1);\n    arr.splice(offset, 0, ...toInsert);\n  }\n\n\n  transferXYZ(dst) {\n    const src = this.sourceArray;\n    //if (dst.length != src.length) {\n    //  throw new Error('dst.length != src.length');\n    //}\n    let y0 = src[1];\n    let yCount = 0;\n    for (let i = 0; i < src.length && i < dst.length; i += 3) {\n      yCount++;\n      const xi = i;\n      const yi = i + 1;\n      const zi = i + 2;\n      const x = src[xi];\n      const y = src[yi];\n      const z = src[zi];\n      if (y != y0) {\n        //console.log('found new y at yCount:' + yCount);\n        yCount = 0;\n        y0 = y;\n      }\n      dst[xi] = src[xi];\n      dst[yi] = src[yi];\n      dst[zi] = src[zi];\n    }\n  }\n}\n","import * as THREE from 'three/build/three.module.js';\nimport XYZArray from './XYZArray.js';\n\n\n/** Scene object to view XYZ file. */\nexport default class XYZObject extends THREE.Object3D {\n  constructor(geometry, usePoints = true) {\n    super();\n    this.origArr = [...geometry.attributes.position.array];\n    this.srcArr = new XYZArray(this.origArr);\n    const sourceBounds = new THREE.Box3;\n    geometry.computeBoundingBox();\n    sourceBounds.copy(geometry.boundingBox);\n    if (usePoints) {\n      this.shape = toPointsShape(this.srcArr.sourceArray, sourceBounds);\n    } else {\n      this.shape = toShape(this.srcArr, sourceBounds);\n    }\n    this.add(this.shape);\n  }\n\n\n  extractSectionAsXYZ(s) {\n    const arr = this.origArr;\n    const lines = [`# ${new Date()}, exported from XYZ tool`];\n    for (let i = 0; i < arr.length; i += 3) {\n      const x = arr[i], y = arr[i + 1], z = arr[i + 2];\n      //console.log(`evaling: ${x} ${y} ${z}`);\n      if (x < s.Xmin || y < s.Ymin || x > s.Xmax || y > s.Ymax) {\n        continue;\n      }\n      lines.push(`${x} ${y} ${z}`);\n    }\n    lines.push('');\n    return lines.join('\\n');\n  }\n\n\n  showSection(xMin, xMax, yMin, yMax) {\n    if (this.section == null) {\n      this.section = this.cutSection(xMin, xMax, yMin, yMax);\n    }\n    this.add(this.section);\n  }\n}\n\n\nfunction toPointsShape(xyzArr, sourceBounds) {\n  const numPoints = xyzArr.length / 3;\n  const coords = new Float32Array(xyzArr.length);\n  const colors = new Float32Array(xyzArr.length);\n  const sizes = new Float32Array(numPoints);\n  for (let i = 0; i < xyzArr.length; i += 3) {\n    const xi = i, yi = i + 1, zi = i + 2;\n    coords[xi] = xyzArr[xi];\n    coords[yi] = xyzArr[yi];\n    coords[zi] = xyzArr[zi];\n    colors[yi] = 0xff;\n    sizes[i / 3] = 1;\n  }\n  const geom = new THREE.BufferGeometry();\n  geom.setAttribute('position', new THREE.BufferAttribute(coords, 3));\n  //geom.setAttribute('color', new THREE.BufferAttribute(colors, 3));\n  geom.setAttribute('size', new THREE.BufferAttribute(sizes, 1));\n  geom.computeBoundingBox();\n  geom.center();\n  const groundMaterial = new THREE.PointsMaterial({\n    color: 0x008800,\n    sizeAttenuation: false,\n    size: 1\n  });\n  const groundPoints = new THREE.Points(geom, groundMaterial);\n  groundPoints.sortParticles = true;\n  groundPoints.sourceBounds = sourceBounds;\n  groundPoints.viewBounds = geom.boundingBox;\n  groundPoints.rotateX(Math.PI / -2);\n  return groundPoints;\n}\n\n\nfunction toShape(xyzArr, sourceBounds) {\n  const [numX, numY] = xyzArr.computeArrayShape();\n  //console.log(`numX:${numX} numY:${numY}`);\n  const geom2 = new THREE.PlaneBufferGeometry(numX, numY, numX - 1, numY - 1);\n  const position = geom2.getAttribute('position');\n  const vertices = position.array;\n  // TODO: there's probably methods in Geometry to do this.\n  xyzArr.transferXYZ(vertices);\n  geom2.center();\n  geom2.computeBoundingBox();\n  geom2.computeFaceNormals();\n  geom2.computeVertexNormals();\n  const obj = new THREE.Mesh(geom2, new THREE.MeshPhongMaterial({\n    color: 'green', side: THREE.DoubleSide, shininess: 10, wireframe: false\n  }));\n  obj.receiveShadow = true;\n  obj.sourceBounds = sourceBounds;\n  obj.viewBounds = geom2.boundingBox;\n  obj.rotateX(Math.PI / -2);\n  return obj;\n}\n\n\nfunction cutSection(xyz, xMin, xMax, yMin, yMax) {\n  if (xyz.length < 3) {\n    throw new Error('Empty data');\n  }\n  const out = [];\n  for (let i = 0; i < xyz.length; i+=3) {\n    const x = xyz[i];\n    const y = xyz[i + 1];\n    const z = xyz[i + 2];\n    if (x >= xMin && x <= xMax\n        && y >= yMin && y <= yMax) {\n      out.push(x, y, z);\n    }\n  }\n  return out;\n}\n","import * as THREE from 'three/build/three.module.js';\nimport {MapControls} from 'three/examples/jsm/controls/OrbitControls.js';\n\nimport Fullscreen from '@pablo-mayrgundter/fullscreen.js/fullscreen.js';\nimport XYZObject from './XYZObject.js';\n\n\nconst zoomBoxOpacity = 0.3;\n\n/**\n * Display XYZObject and active section selection.  Defaults to\n * binding DOM elt '#view'.\n */\nexport default class View extends THREE.Scene {\n  constructor(container = document.querySelector('#view'), animCb = null) {\n    super();\n    if (!container) {\n      throw new Error('View container not found');\n    }\n    this.container = container;\n    this.animCb = animCb;\n    this.width = container.innerWidth;\n    this.height = container.innerHeight;\n    this.camera = new THREE.PerspectiveCamera(45, this.width / this.height, 0.1, 1e10);\n    this.camera.position.set(0, 3e1, 1.5e2);\n    this.add(this.camera);\n    this.add(new THREE.AxesHelper);\n    const radius = 6357 * 1000; // (radius in meters; 1 gl unit = 1 meter)\n    const globe = new THREE.Mesh(\n      new THREE.SphereGeometry(radius, 120, 120 / 2),\n      new THREE.MeshPhongMaterial({\n        flatShading: false,\n        wireframe: true,\n        color: 0xaaffaa,\n      }));\n    const altitudeOffset = 1e1; // todo\n    globe.position.set(0, -radius - altitudeOffset, 0);\n    globe.rotateX(Math.PI / 2);\n    this.add(globe);\n    this.background = new THREE.Color(0xbfd1e5);\n    const light = new THREE.PointLight();\n    //this.add(new THREE.AmbientLight());\n    // TODO: better shadows.\n    // https://github.com/mrdoob/three.js/issues/8238\n    // https://github.com/mrdoob/three.js/pull/15670\n    light.castShadow = true;\n    light.intensity = zoomBoxOpacity;\n    light.shadow.camera.near = 0.5;\n    light.shadow.camera.far = 250;\n    light.shadow.camera.width = 256;\n    light.shadow.camera.height = 256;\n    light.position.set(-5e1, 1e6, -5e1);\n    this.add(light);\n    this.light = light;\n    const shadowLight = light.clone();\n    shadowLight.castShadow = false;\n    shadowLight.intensity = 1.0 - zoomBoxOpacity;\n    this.add(shadowLight);\n    this.renderer = new THREE.WebGLRenderer({antialias: true});\n    this.renderer.shadowMap.enabled = true;\n    //TODO: check about the mobile thing\n    //renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(this.width, this.height);\n    container.appendChild(this.renderer.domElement);\n    this.controls = new MapControls(this.camera, this.renderer.domElement);\n    this.fs = new Fullscreen(container, () => {\n        this.onWindowResize();\n      });\n    this.onWindowResize();\n    window.addEventListener('resize', () => {\n        this.onWindowResize();\n      });\n    this.animate();\n    document.view = this;\n    this.zoomBox = null;\n  }\n\n\n  displayXYZObject(xyzObj) {\n    if (this.xyzObj) {\n      this.remove(this.xyzObj);\n    }\n    this.add(xyzObj);\n    this.xyzObj = xyzObj;\n    this.light.target = xyzObj;\n  }\n\n\n  focus(zoomBoundsIn) {\n    if (zoomBoundsIn == null) {\n      throw new Error('zoomBoundsIn null');\n    }\n    const zoomBounds = {\n      min: { x: zoomBoundsIn.Xmin, y: zoomBoundsIn.Ymin },\n      max: { x: zoomBoundsIn.Xmax, y: zoomBoundsIn.Ymax }\n    };\n    const sourceBounds = this.xyzObj.children[0].sourceBounds;\n    const sourceWidth = sourceBounds.max.x - sourceBounds.min.x;\n    const sourceDepth = sourceBounds.max.y - sourceBounds.min.y;\n    const viewBounds = this.xyzObj.children[0].viewBounds;\n    const viewWidth = viewBounds.max.x - viewBounds.min.x;\n    const viewDepth = viewBounds.max.y - viewBounds.min.y;\n    const viewXOff = viewBounds.min.x;\n    const viewYOff = viewBounds.min.y;\n    const zoomX = zoomBounds.min.x;\n    const zoomY = zoomBounds.min.y;\n    const zoomWidth = zoomBounds.max.x - zoomBounds.min.x;\n    const zoomDepth = zoomBounds.max.y - zoomBounds.min.y;\n    const ZOOM_EXTRA = 1;\n    const zoomHeight = viewBounds.max.z - viewBounds.min.z + ZOOM_EXTRA;\n    const boxX = zoomX - sourceBounds.min.x;\n    const boxY = zoomY - sourceBounds.min.y;\n    const boxWidth = zoomWidth / sourceWidth * viewWidth;\n    const boxHeight = zoomHeight;\n    const boxDepth = zoomDepth / sourceDepth * viewDepth;\n    const geometry = new THREE.BoxGeometry(boxWidth, boxHeight, boxDepth);\n    geometry.center();\n    const material = new THREE.MeshBasicMaterial({\n        color: 0xffffff, transparent: true, opacity: zoomBoxOpacity});\n    const box = new THREE.Mesh(geometry, material);\n    box.castShadow = true;\n    box.receiveShadow = true;\n    const wireBox = box.clone();\n    wireBox.castShadow = false;\n    wireBox.receiveShadow = false;\n    wireBox.material = new THREE.MeshBasicMaterial({\n        color: 0xccccff, transparent: true, opacity: zoomBoxOpacity, wireframe: true});\n    box.add(wireBox);\n    if (this.zoomBox) {\n      this.remove(this.zoomBox);\n    }\n    this.add(this.zoomBox = box);\n    function b2s(name, b) {\n      return `${name}(min: x:${b.min.x} y:${b.min.y} z:${b.min.z} max: x:${b.max.x} y:${b.max.y} z:${b.max.z})`;\n    }\n    box.position.x = viewXOff + boxX + boxWidth - (boxWidth / 2);\n    // Note y swapped to z.\n    box.position.z = -viewYOff - boxY - boxDepth + (boxDepth / 2);\n    box.position.y -= (ZOOM_EXTRA / 2);\n    // console.log(`box(x: ${boxX} y:${boxY} w:${boxWidth} h:${boxHeight} d:${boxDepth})`);\n    // console.log(`box(x: ${boxX} y:${boxY} w:${boxWidth} h:${boxHeight} d:${boxDepth}) zoomX:${zoomX}`,\n    //            b2s('source', sourceBounds), b2s('view', viewBounds), b2s('zoom', zoomBounds),\n    //            box.position);\n  }\n\n\n  animate() {\n    this.controls.update();\n    this.renderer.render(this, this.camera);\n    if (this.animCb) {\n      this.animCb(this);\n    }\n    requestAnimationFrame(() => {\n        this.animate();\n      });\n  }\n\n\n  onWindowResize() {\n    if (this.fs.isFullscreen()) {\n      this.width = window.innerWidth;\n      this.height = window.innerHeight;\n    } else {\n      this.width = this.container.offsetWidth;\n      this.height = this.container.offsetHeight;\n    }\n    this.camera.aspect = this.width / this.height;\n    this.camera.updateProjectionMatrix();\n    this.renderer.setSize(this.width, this.height);\n  }\n}\n\n\n","import Vue from 'vue';\nimport * as Diurnal from '@pablo-mayrgundter/diurnal.js';\nimport {XYZLoader} from 'three/examples/jsm/loaders/XYZLoader.js';\n\nimport App from './App.vue';\nimport FileLoaderControl from './FileLoaderControl.js';\nimport SelectionControl from './SelectionControl.js';\nimport View from './View.js';\nimport XYZObject from './XYZObject.js';\n\n// TODO(https://github.com/buildrs/xyz/issues/1): CSS loading is weird.\nimport css from '../../public/index.css';\n\n\nDiurnal.bind();\n\nlet sc;\nconst view = new View();\n\nconst vm = new Vue({\n  el: '#app',\n  render: h => h(App),\n  methods: {\n    setLv95AndRadius(N, E, R) {\n      const c = this.$children[0];\n      c.setLv95(N, E);\n      c.setRadius(10);\n    }\n  }\n});\n\n\nvm.$on('coord-radius-change', e => {\n  const c = e.coord, r = e.radius;\n  //console.log(`coord-radius-change: wgs(${c.lat},${c.lon}) lv(${c.N},${c.E}) r(${r})`);\n  const zoom = {\n    Xmin: c.E - r,\n    Xmax: c.E + r,\n    Ymin: c.N - r,\n    Ymax: c.N + r,\n  };\n  //console.log('zoom', zoom);\n  view.focus(zoom);\n  sc.processBounds(zoom, document.getElementById('dlbtn'));\n});\n\n\nconst display = geometry => {\n  const obj = new XYZObject(geometry);\n  view.displayXYZObject(obj);\n  const bounds = obj.shape.sourceBounds;\n  const N = bounds.min.y + (bounds.max.y - bounds.min.y) / 2;\n  const E = bounds.min.x + (bounds.max.x - bounds.min.x) / 2;\n  vm.setLv95AndRadius(N, E, 10);\n  sc = new SelectionControl(obj, obj.shape.sourceBounds, obj.shape.viewBounds, zoom => {\n    view.focus(zoom);\n  });\n};\n\n\nconst selectElt = document.querySelector(\"select[name='sources']\");\nselectElt.addEventListener('change', () => {\n    new XYZLoader().load(selectElt.value, display);\n  });\nnew XYZLoader().load(selectElt.value, display);\n\nconst fileLoaderElt = document.getElementById('fileLoader');\nconst fileCtrl = new FileLoaderControl(fileLoaderElt, loadedXyz => {\n    display(new XYZLoader().parse(loadedXyz));\n  });\n\n\nfunction handleHash() {\n  let hash = location.hash.substr(1);\n}\nwindow.addEventListener('hashchange', handleHash);\nhandleHash();\n","// Ported from:\n//\n// Implementation of Formulas and constants for the calculation of the\n// Swiss conformal cylindrical projection and for the transformation\n// between coordinate systems. December 2016.  For download at:\n//\n// https://www.swisstopo.admin.ch/content/swisstopo-internet/en/topics/survey/reference-systems/switzerland/_jcr_content/contentPar/tabs/items/dokumente_publikatio/tabPar/downloadlist/downloadItems/517_1459343190376.download/refsys_e.pdf\n\nconst π = Math.PI, τ = 2 * π;\nconst sqrt = Math.sqrt, exp = Math.exp, ln = Math.log,\n  sin = Math.sin, cos = Math.cos, tan = Math.tan,\n  asin = Math.asin, atan = Math.atan;\n\n\nconst DEGREE = 1 / 360;\nconst MINUTE = 1 / 360 / 60;\nconst SECOND = 1 / 360 / 3600;\n\nexport function dms2deg(deg, min = 0, sec = 0) {\n  return deg + min / 60 + sec / 3600;\n}\n\n\nexport function deg2rad(deg, min = 0, sec = 0) {\n  return τ * (deg * DEGREE + min * MINUTE + sec * SECOND);\n}\n\n\nexport function deg2sec(deg, min = 0, sec = 0) {\n  return 3600 * deg + 60 * min + sec;\n}\n\n\nexport function deg2dms(degIn) {\n  const deg = Math.floor(degIn);\n  const minIn = ((degIn % 1) * 60);\n  const min = Math.floor(minIn);\n  const sec = ((minIn % 1) * 60);\n  return [deg, min, sec];\n}\n\n\n/**\n * 4.1 Approximate formulas for the transformation between Swiss\n * projection coordinates and WGS84.\n * @return [N, E]\n */\nexport function wgs2lv95(latt, lngg) {\n  const latArc = latt * 3600;\n  const lngArc = lngg * 3600;\n  const lat = (latArc - 169028.66) / 10000; // φ'\n  const lng = (lngArc - 26782.5) / 10000; // λ'\n\n  const lat2 = lat * lat, lat3 = lat2 * lat;\n  const lng2 = lng * lng, lng3 = lng2 * lng;\n\n  const E = 2600072.37\n    + 211455.93 * lng\n    - 10938.51 * lng * lat\n    - 0.36 * lng * lat2\n    - 44.54 * lng3;\n\n  const N = 1200147.07\n    + 308807.95 * lat\n    + 3745.25 * lng2\n    + 76.63 * lat2\n    - 194.56 * lng2 * lat\n    + 119.79 * lat3;\n\n  // TODO: why the fixup for roundtrip?\n  return [parseFloat(N.toFixed(2)) - 0.02, parseFloat(E.toFixed(2)) + 0.02];\n}\n\n\n/**\n * 4.2 Approximate formulas for the direct transformation of Swiss\n * projection coordinates to ellipsoidal WGS84 coordinates.\n * @return [lat, lng]\n */\nexport function lv952wgs(N, E) {\n  const Ep = (E - 2600000) / 1000000;\n  const Np = (N - 1200000) / 1000000;\n  const xp = Np, yp = Ep,\n    xp2 = xp * xp, xp3 = xp2 * xp,\n    yp2 = yp * yp, yp3 = yp2 * yp;\n  const λp = 2.6779094\n    + 4.728982 * yp\n    + 0.791484 * yp * xp\n    + 0.1306 * yp * xp2\n    - 0.0436 * yp3;\n  const φp = 16.9023892\n    + 3.238272 * xp\n    - 0.270978 * yp2\n    - 0.002528 * xp2\n    - 0.0447 * yp2 * xp\n    - 0.0140 * xp3;\n  const λ = λp * 100 / 36;\n  const φ = φp * 100 / 36;\n  return [φ, λ];\n}\n\n\n// https://www.movable-type.co.uk/scripts/latlong.html\n// MIT License\n// NB: https://www.movable-type.co.uk/scripts/latlong-vincenty.html\nexport function distanceHaversine(lat1, lon1, lat2, lon2) {\n  // TODO: replace with computed value from reference ellipsoid.\n  const R = 6371e3; // metres\n  const toRad = π / 180;\n  const φ1 = lat1 * toRad; // φ, λ in radians\n  const φ2 = lat2 * toRad;\n  const Δφ = (lat2 - lat1) * toRad;\n  const Δλ = (lon2 - lon1) * toRad;\n  const a = sin(Δφ / 2) * sin(Δφ / 2) +\n    cos(φ1) * cos(φ2) *\n    sin(Δλ / 2) * sin(Δλ / 2);\n  const c = 2 * Math.atan2(sqrt(a), sqrt(1 - a));\n  const d = R * c; // in metres\n  return d;\n}\n\n\nexport class Ellipsoid {\n  /**\n   * @param φ0 ellipsoidal latitude of the projection centre\n   * @param λ0 ellipsoidal longitude of the projection centre\n   */\n  constructor(semiMajor, semiMinor, φ0, λ0) {\n    this.semiMajor = semiMajor;\n    this.semiMinor = semiMinor;\n    this.flatteningInverse = this.semiMajor / (this.semiMajor - this.semiMinor);\n    const a2 = this.semiMajor * this.semiMajor;\n    const b2 = this.semiMinor * this.semiMinor;\n    // 1st numerical eccentricity (squared) of the Bessel ellipsoid (*).\n    //this.E2 = (a2 - b2) / a2;\n    this.E2 = 0.006674372230614;\n    // Only E is directly used in the calculations below.\n    this.E = sqrt(this.E2);\n    this.φ0 = φ0;\n    this.λ0 = λ0;\n    this.R = this.radiusOfProjectionSphere();\n    // Relat. between longitude on sphere and on ellipsoid.\n    //this.α = this.computeα();\n    this.α = 1.00072913843038;\n  }\n\n\n  /**\n   * Helper to compute radius of the projection sphere; meters.\n   * @private\n   */\n  radiusOfProjectionSphere() {\n    return this.semiMajor * sqrt(1 - this.E2) / (1 - this.E2 * this.sin2(this.φ0));\n  }\n\n\n  /**\n   * Helper to compute relationship between longitude on sphere and on\n   * ellipsoid.\n   * @private\n   */\n  computeα() {\n    return sqrt(1 + this.E2 / (1 - this.E2) * this.cos4(this.φ0));\n  }\n\n\n  // @private\n  sin2(θ) {\n    const s = sin(θ);\n    return s * s;\n  }\n\n\n  cos4(θ) {\n    const s = cos(θ);\n    return s * s * s * s;\n  }\n}\n\n\nexport class BesselEllipsoid extends Ellipsoid {\n  /**\n   * Bessel ellipsoid with a projection center.\n   * @param φ0 ellipsoidal latitude of the projection centre\n   * @param λ0 ellipsoidal longitude of the projection centre\n   */\n  constructor(φ0, λ0) {\n    super(6377397.155, 6356078.962822, φ0, λ0);\n  }\n}\n\n\nexport const BernBesselEllipsoid =\n    new BesselEllipsoid(deg2rad(46, 57, 8.66), deg2rad(7, 26, 22.50));\n\n\n// Latitude of the fundamental point on the sphere.\nconst b0 = deg2rad(46, 54, 27.83324844);\n\n// Constant of the latitude formula.\nconst K = 0.0030667323772751;\n\n\n/**\n * See: 3.2 Ellipsoidal coordinates (λ, φ on the Bessel ellipsoid) ⇒\n * Swiss projection coordinates (rigorous formulas)\n */\nexport function ellipsoidToLV95(φ, λ, eoid = BernBesselEllipsoid) {\n  // a) Bessel ellipsoid (φ, λ) ⇒ sphere (b, l) (Gauss projection)\n  const α = eoid.α, E = eoid.E, R = eoid.R;\n  const S = α * ln(tan(π/4 + φ/2)) - α * E / 2\n    * ln((1 + E * sin(φ)) / (1 - E * sin(φ))) + K;\n  const b = 2 * (atan(exp(S)) - π/4);\n  const l = α * (λ - eoid.λ0);\n  // b) equator system (b, l) ⇒ pseudo-equator system ( b ) (rotation)\n  const ll = atan(sin(l) / (sin(b0) * tan(b) + cos(b0)  * cos(l)));\n  const bb = asin(cos(b0) * sin(b) - sin(b0) * cos(b) * cos(l));\n  // c) sphere (b), l ⇒ projection plane (y, x) (Mercator projection)\n  const yy = R * ll;\n  const xx = R / 2 * ln((1 + sin(bb)) / (1 - sin(bb)));\n  const yyy = yy + 2600000;\n  const xxx = xx + 1200000;\n  return [yyy, xxx];\n}\n\n\n/**\n * See: 3.3 Swiss projection coordinates (y, x) ⇒ ellipsoidal coordinates\n * (λ, φ) (rigorous formulas)\n */\nexport function LV95ToEllipsoid(East, North, eoid = BernBesselEllipsoid) {\n  // a) projection plane (y, x) ⇒  sphere (b)\n  const α = eoid.α, E = eoid.E, R = eoid.R, λ0 = eoid.λ0;\n  const Y = East - 2600000;\n  const X = North - 1200000;\n  const ll = Y / R;\n  const bb = 2 * (atan(exp(X / R)) - π/4);\n  // b) pseudo-equator system (b), l ⇒ equator system (b, l)\n  const b = asin(cos(b0) * sin(bb) + sin(b0) * cos(bb) * cos(ll));\n  const l = atan(sin(ll) / (cos(b0) * cos(ll) - sin(b0) * tan(bb)));\n  // c) sphere (b, l) ⇒ Bessel ellipsoid (φ, λ)\n  const λ = λ0 + l / α;\n  let φ = b;\n  let S = 0;\n  const threshold = 0.000000000001; // TODO: this is just an arb small num.\n  for (let i = 0; i < 10; i++) {\n    const newS =  1/α * ln(tan(π/4 + b/2) - K) + E\n      * ln(tan(π/4 + asin(E * asin(φ)) / 2));\n    const newφ = 2 * atan(exp(S)) - π/2;\n    if (newS - S < threshold && newφ - φ < threshold) {\n      break;\n    }\n    S = newS;\n    φ = newφ;\n  }\n  return [λ, φ];\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('p',[_c('select',{attrs:{\"name\":\"input_format\"},on:{\"change\":function($event){return _vm.onSelect($event.target.value)}}},[_c('option',{attrs:{\"value\":\"dms\"}},[_vm._v(\"Deg°/Min'/Sec\\\"\")]),_c('option',{attrs:{\"value\":\"deg\"}},[_vm._v(\"Deg°\")]),_c('option',{attrs:{\"value\":\"lv95\"}},[_vm._v(\"LV95\")])])]),_c('form',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.dms.show),expression:\"dms.show\"}],attrs:{\"name\":\"coords_dms\"}},[_c('table',[_c('tr',[_c('td',[_vm._v(\"Latitude:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.dms.lat.deg),expression:\"dms.lat.deg\"}],attrs:{\"type\":\"number\",\"step\":\"any\"},domProps:{\"value\":(_vm.dms.lat.deg)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.dms.lat, \"deg\", $event.target.value)}}}),_vm._v(\"° \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.dms.lat.min),expression:\"dms.lat.min\"}],attrs:{\"type\":\"number\",\"step\":\"any\"},domProps:{\"value\":(_vm.dms.lat.min)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.dms.lat, \"min\", $event.target.value)}}}),_vm._v(\"' \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.dms.lat.sec),expression:\"dms.lat.sec\"}],attrs:{\"type\":\"number\",\"step\":\"0.05\"},domProps:{\"value\":(_vm.dms.lat.sec)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.dms.lat, \"sec\", $event.target.value)}}})])]),_c('tr',[_c('td',[_vm._v(\"Longitude:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.dms.lon.deg),expression:\"dms.lon.deg\"}],attrs:{\"type\":\"number\",\"step\":\"any\"},domProps:{\"value\":(_vm.dms.lon.deg)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.dms.lon, \"deg\", $event.target.value)}}}),_vm._v(\"° \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.dms.lon.min),expression:\"dms.lon.min\"}],attrs:{\"type\":\"number\",\"step\":\"any\"},domProps:{\"value\":(_vm.dms.lon.min)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.dms.lon, \"min\", $event.target.value)}}}),_vm._v(\"' \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.dms.lon.sec),expression:\"dms.lon.sec\"}],attrs:{\"type\":\"number\",\"step\":\"0.05\"},domProps:{\"value\":(_vm.dms.lon.sec)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.dms.lon, \"sec\", $event.target.value)}}})])])])]),_c('form',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.deg.show),expression:\"deg.show\"}],attrs:{\"name\":\"coords_degrees\"}},[_c('table',[_c('tr',[_c('td',[_vm._v(\"Latitude:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.deg.lat),expression:\"deg.lat\"}],attrs:{\"type\":\"number\",\"step\":\"any\"},domProps:{\"value\":(_vm.deg.lat)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.deg, \"lat\", $event.target.value)}}}),_vm._v(\"° N \")])]),_c('tr',[_c('td',[_vm._v(\"Longitude:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.deg.lon),expression:\"deg.lon\"}],attrs:{\"type\":\"number\",\"step\":\"any\"},domProps:{\"value\":(_vm.deg.lon)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.deg, \"lon\", $event.target.value)}}}),_vm._v(\"° E \")])])])]),_c('form',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.lv95.show),expression:\"lv95.show\"}],attrs:{\"name\":\"coords_lv95\"}},[_c('table',[_c('tr',[_c('td',[_vm._v(\"X:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.ESlider),expression:\"ESlider\"}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"100\"},domProps:{\"value\":(_vm.ESlider)},on:{\"__r\":function($event){_vm.ESlider=$event.target.value}}})]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.lv95.E),expression:\"lv95.E\"}],attrs:{\"type\":\"number\",\"step\":\"any\"},domProps:{\"value\":(_vm.lv95.E)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.lv95, \"E\", $event.target.value)}}})])]),_c('tr',[_c('td',[_vm._v(\"Y:\")]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.NSlider),expression:\"NSlider\"}],attrs:{\"type\":\"range\",\"min\":\"0\",\"max\":\"100\"},domProps:{\"value\":(_vm.NSlider)},on:{\"__r\":function($event){_vm.NSlider=$event.target.value}}})]),_c('td',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.lv95.N),expression:\"lv95.N\"}],attrs:{\"type\":\"number\",\"step\":\"any\"},domProps:{\"value\":(_vm.lv95.N)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.lv95, \"N\", $event.target.value)}}})])])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n<div>\n  <p>\n    <select name=\"input_format\" v-on:change=\"onSelect($event.target.value)\">\n      <option value=\"dms\">Deg°/Min'/Sec\"</option>\n      <option value=\"deg\">Deg°</option>\n      <option value=\"lv95\">LV95</option>\n    </select>\n    <form name=\"coords_dms\" v-show=\"dms.show\">\n      <table>\n        <tr>\n          <td>Latitude:</td>\n          <td>\n            <input v-model=\"dms.lat.deg\" type=\"number\" step=\"any\">°\n            <input v-model=\"dms.lat.min\" type=\"number\" step=\"any\">'\n            <input v-model=\"dms.lat.sec\" type=\"number\" step=\"0.05\">\n          </td>\n        </tr>\n        <tr>\n          <td>Longitude:</td>\n          <td>\n            <input v-model=\"dms.lon.deg\" type=\"number\" step=\"any\">°\n            <input v-model=\"dms.lon.min\" type=\"number\" step=\"any\">'\n            <input v-model=\"dms.lon.sec\" type=\"number\" step=\"0.05\">\n          </td>\n        </tr>\n      </table>\n    </form>\n    <form name=\"coords_degrees\" v-show=\"deg.show\">\n      <table>\n        <tr>\n          <td>Latitude:</td>\n          <td>\n            <input v-model=\"deg.lat\" type=\"number\" step=\"any\">° N\n          </td>\n        </tr>\n        <tr>\n          <td>Longitude:</td>\n          <td>\n            <input v-model=\"deg.lon\" type=\"number\" step=\"any\">° E\n          </td>\n        </tr>\n      </table>\n    </form>\n    <form name=\"coords_lv95\" v-show=\"lv95.show\">\n      <table>\n        <tr>\n          <td>X:</td>\n          <td><input v-model=\"ESlider\" type=\"range\" min=\"0\" max=\"100\"></td>\n          <td><input v-model=\"lv95.E\" type=\"number\" step=\"any\"></td>\n        </tr>\n        <tr>\n          <td>Y:</td>\n          <td><input v-model=\"NSlider\" type=\"range\" min=\"0\" max=\"100\"></td>\n          <td><input v-model=\"lv95.N\" type=\"number\" step=\"any\"></td>\n        </tr>\n      </table>\n    </form>\n</div>\n</template>\n<script>\nimport {dms2deg, wgs2lv95, lv952wgs, deg2dms} from './coords.js';\nexport default {\n  props: {\n    initCoord: Object,\n    initLv: Object\n  },\n  data() {\n    return {\n      dms: {\n        show: true,\n        lat: {\n          deg: this.initCoord.latDeg || 2,\n          min: this.initCoord.latMin || 0,\n          sec: this.initCoord.latSec || 0\n        },\n        lon: {\n          deg: this.initCoord.lonDeg || 0,\n          min: this.initCoord.lonMin || 0,\n          sec: this.initCoord.lonSec || 0\n        }\n      },\n      deg: {\n        show: false,\n        lat: this.initCoord.lat || 0,\n        lon: this.initCoord.lon || 0\n      },\n      lv95: {\n        show: false,\n        N: this.initLv.N || 1200000,\n        E: this.initLv.E || 2600000,\n        nMin: this.initLv.nMin || Number.MIN_VALUE,\n        nMax: this.initLv.nMax || Number.MAX_VALUE,\n        eMin: this.initLv.eMin || Number.MIN_VALUE,\n        eMax: this.initLv.eMax || Number.MAX_VALUE,\n      },\n      NSlider: 50,\n      ESlider: 50,\n      coord: {\n        lat: this.initCoord.lat || 0,\n        lon: this.initCoord.lon || 0,\n        latMin: Number.MIN_VALUE,\n        latMax: Number.MAX_VALUE,\n        lonMin: Number.MIN_VALUE,\n        lonMax: Number.MAX_VALUE\n      },\n    }\n  },\n  methods: {\n    setLatLon(lat, lon) {\n      this.deg.lat = lat;\n      this.deg.lon = lon;\n    },\n    setLv95(N, E) {\n      this.lv95.N = N;\n      this.lv95.E = E;\n    },\n    onSelect(value) {\n      this.dms.show = false;\n      this.deg.show = false;\n      this.lv95.show = false;\n      const lat = this.coord.lat, lon = this.coord.lon;\n      switch(value) {\n      case 'dms':\n        const dms = this.dms;\n        [dms.lat.deg, dms.lat.min, dms.lat.sec] = deg2dms(lat);\n        [dms.lon.deg, dms.lon.min, dms.lon.sec] = deg2dms(lon);\n        break;\n      case 'deg': [this.deg.lat, this.deg.lon] = [lat, lon]; break;\n      case 'lv95': [this.lv95.N, this.lv95.E] = wgs2lv95(lat, lon); break;\n      }\n      this[value].show = true;\n    }\n  },\n  watch: {\n    coord: {\n      handler() {\n        const c = this.coord;\n        const lv = wgs2lv95(c.lat, c.lon);\n        const changeEvent = {wgs:{lat: c.lat, lon: c.lon}, lv95:{N:lv[0], E:lv[1]}};\n        this.$root.$emit('coord-changed', changeEvent);\n        this.$emit('coord-changed', changeEvent);\n      },\n      deep: true\n    },\n    dms: {\n      handler() {\n        const dms = this.dms;\n        this.coord.lat = dms2deg(parseFloat(dms.lat.deg), parseFloat(dms.lat.min), parseFloat(dms.lat.sec));\n        this.coord.lon = dms2deg(parseFloat(dms.lon.deg), parseFloat(dms.lon.min), parseFloat(dms.lon.sec));\n      },\n      deep: true\n    },\n    deg: {\n      handler() {\n        this.coord.lat = dms2deg(parseFloat(this.deg.lat));\n        this.coord.lon = dms2deg(parseFloat(this.deg.lon));\n      },\n      deep: true\n    },\n    lv95: {\n      handler() {\n        [this.coord.lat, this.coord.lon] = lv952wgs(parseFloat(this.lv95.N), parseFloat(this.lv95.E));\n      },\n      deep: true\n    },\n    NSlider: {\n      handler() {\n        const min = this.lv95.nMin, max = this.lv95.nMax;\n        const rangeN = this.NSlider;\n        const value = parseFloat((min + (rangeN / 100 * (max - min))).toFixed(2));\n        this.lv95.N = value;\n        [this.coord.lat, this.coord.lon] = lv952wgs(this.lv95.N, this.lv95.E);\n      }\n    },\n    ESlider: {\n      handler() {\n        const min = this.lv95.eMin, max = this.lv95.eMax;\n        const rangeE = this.ESlider;\n        const value = parseFloat((min + (rangeE / 100 * (max - min))).toFixed(2));\n        this.lv95.E = value;\n        [this.coord.lat, this.coord.lon] = lv952wgs(this.lv95.N, this.lv95.E);\n      }\n    }\n  }\n};\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CoordsForm.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CoordsForm.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CoordsForm.vue?vue&type=template&id=0914af32&\"\nimport script from \"./CoordsForm.vue?vue&type=script&lang=js&\"\nexport * from \"./CoordsForm.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}